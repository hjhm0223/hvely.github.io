---
template: SinglePost
title: Concurrency
status: Published
date: '2020-04-01'
featuredImage: >-
excerpt: >-
  
categories:
  - category: Study
meta:
  description: test meta description
  title: test meta title
---



## 기본 개념

- **프로세서**
  - 컴퓨터 하드웨어 측면에서 프로그램을 수행하는 하드웨어 유닛. 대표적으로 중앙처리장치를 말하며 컴퓨터 한 대가 여러 프로세서를 가지면 멀티 프로세서라 한다.
- **코어**
  - 프로세서의 코어는 주요 연산회로인데, 싱글코어는 연산회로가 하나인 것을 말하고, 듀얼 코어, 멀티코어는 연산회로가 여러 개인것을 말한다.
- **프로그램과 프로세스**
  - 프로그램은 일반적으로 보조 기억장치에 저장된 실행코드(즉 생명이 없는 상태)를 말한다. 프로세스는 프로그램을 구동하여 프로그램 자체와 프로그램의 상태가 메모리에서 실행되는 작업 단위를 말한다. 여러 개의 프로세스를 동시에 운용하는 것을 멀티 태스킹이라 하며 이는 운영체제에서 담당하게 된다.
- **스레드**
  - 스레드는 프로세스 내에서 실행되는 작업흐름의 단위를 말한다. 보통 한 프로세스는 하나의 스레드를 갖고 있는데, 프로세스의 환경에 따라 동시에 둘 이상의 스레드를 실행할 수 있다. 이러한 방식을 멀티스레딩이라 한다. 그리고 프로그램이 시작될 때 동작하는 스레드를 메인스레드, 나중에 생성된 스레드를 서브 또는 세컨더리 스레드라고 한다.
- **비동기 프로그래밍**
  - 프로그램의 주 실행 흐름을 멈춰서 기다리는 부분이 없이 바로 다음 작업을 수행할 수 있게 하는 방식
  - 코드의 실행 결과를 별도의 공간에 맡겨둔 뒤 결과를 기다리지 않고 다음 코드를 실행하는 병렬처리 방식



## 동시성과 병렬성의 차이

### 병렬성(Parallelism) 프로그래밍

- 실제로 동시에 여러 작업이 처리되는 것 
- **멀티코어**에서 멀티스레드를 실행시키는 방식으로 데이터 병렬성과 작업 병렬성으로 나뉜다.
  - 데이터 병렬성
    - 전체 데이터를 나누어 서브 데이터들로 만든 뒤 서브 데이터들을 병렬 처리하여 작업을 빠르게 수행하는 방법
  - 작업 병렬성
    - 서로 다른 작업을 병렬 처리하는 방법
- 한번에 많은 일을 처리
- 물리적인 개념



### 동시성(Concurrency) 프로그래밍

- 동시에 실행되는 것 같이 보이는 것
- **싱글 코어**에서 멀티쓰레드를 동작시키는 방식
- 한번에 많은 것을 처리
- 논리적인 개념

공유하고 변경 가능한 상태에 대한 접근을 통제

- 멀티쓰레드에 안전한 코드를 만든다는 것은
  - 상태를 쓰레드 간에 공유하지 않는다.
  - 상태를 변경 불가능하게 한다. (final)
  - 상태에 접근할 때에 동기화를 사용한다.
    - 하나 이상의 쓰레드가 상태에 접근하고 그 중 하나가 변경할 수 있다면 이 모든 쓰레드들은 동기화를 통해 해당 상태에 대한 접근을 **순서**대로 배열해야 한다.



### 동시성과 병렬성의 차이

- 모두 비동기 동작을 구현할 수 있지만 동작 원리에 차이가 있다.
- 동시성
  - 싱글 코어에서 여러 개의 작업을 동시에 실행되는 것처럼 보이게 하기 위해 작업을 번갈아 수행한다.
  - 다른 작업으로 바꾸어 실행할 때 내부적으로 Context switch가 일어난다.
- 병렬성
  - 멀티 코어에서 각각 수행한다.

![img](https://t1.daumcdn.net/cfile/tistory/995359405FBBB9591C)



## 추가내용

### 서블릿

상태가 없으면 통제할 대상이 없으므로 항상 멀티쓰레드에 안전

- 상태에 대한 접근이 생길 때
  - 동작 전체를 동기화 (synchronized) : 전역 순서를 정해주는 것. 성능 문제.
    - Vector
    - Hashtable
    - Collections.synchronizedXxx

### 동기화

- 동기화의 관리 비용
  - 시스템 내에서 일관성을 유지하기 위해 지불해야하는 시간의 비율
    - Apache
    - nginx: 메모리 사용. 최근 사용 많아짐

### 가시성

- 가시성 보장
  - Lock (synchronized) 를 걸면 가시성에 대한 보장이 생김
  - volatile로 선언한 변수는 갱신 즉시 다른 쓰레드에서 보이며 다른 메모리 동작과 재배열하지 않음

### 분산처리

- 공유하고 변경 가능한 상태는 **RDB**에 존재
  - 상태를 노드 간에 공유하지 않는다
  - 상태를 변경 불가능하게 한다
  - 상태에 접근할 때 **트랜잭션**을 사용한다
- 상태의 처리에 확장성을 고려하려면 RDB를 넘어서야 함
  - Global Lock의 실효성
  - 트랜잭션의 유실



## References

- 기본개념

  https://velog.io/@chan33344/%EB%8F%99%EC%8B%9C%EC%84%B1-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D

- 병렬성, 동시성 비교

  https://seamless.tistory.com/42

- Apache vs Nginx

  http://blog.illunex.com/nginx-%EC%9B%B9%EC%84%9C%EB%B2%84-%EB%9D%84%EC%9B%8C%EB%B3%B4%EA%B8%B0/

- 강의 내용

  - http://www.gotw.ca/publications/concurrency-ddj.htm
  - Akka 코딩 공작소
  - https://akka.io
  - 자바 병렬 프로그래밍
  - Reactive Design Patterns